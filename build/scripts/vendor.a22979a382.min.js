var ctx,viewWidth=window.innerWidth,viewHeight=window.innerHeight,drawingCanvas=document.getElementById("fx-network"),timeStep=.02,time=0,nodes=[],signals=[],signalCount=0;function initDrawingCanvas(){drawingCanvas.width=viewWidth,drawingCanvas.height=viewHeight,ctx=drawingCanvas.getContext("2d")}function createNodes(){for(var t=1*viewWidth-10,i=0;i<20;i++){var n=Math.random()*(2*Math.PI),e=Math.sqrt(Math.random()),s=t*e*Math.cos(n)+.5*viewWidth,o=t*e*Math.sin(n)+.5*viewWidth;nodes[i]=new Node(s,o)}}function connectNodes(){for(var t,i,n,e=0;e<nodes.length;e++)for(i=0,n=Math.floor(randomRange(2,4));i<n;)t=getRandom(nodes),nodes[e]!==t&&(nodes[e].connections.push(t),i++)}function transmit(){signals.push(new Signal(getRandom(nodes))),signalCount++}function update(){nodes.forEach(function(t){t.update()}),signals.forEach(function(t){!0===t.update()&&signals.splice(signals.indexOf(t),1)})}function draw(){ctx.clearRect(0,0,viewWidth,viewHeight),nodes.forEach(function(t){t.draw()}),signals.forEach(function(t){t.draw()})}function loop(){update(),draw(),time+=timeStep,requestAnimationFrame(loop)}function Node(t,i){this.x=this._x=t,this.y=this._y=i,this.connections=[],this.r=randomRange(-10,10)}function Signal(t){this.start=t,this.parts=[],this.completeParts=[],this.strength=2,this.jumps=0;var i=signalCount%12*30;this.style="hsl("+i+",100%,50%)";for(var n=0;n<t.connections.length;n++)this.parts.push(new SignalPart(this.start,this.start.connections[n],this.strength,this.style))}function SignalPart(t,i,n,e){this.start=t,this.end=i,this.strength=n,this.style=e,this._time=0,this.prevTime=0,this.duration=2,this.complete=!1,this.p0={x:0,y:0},this.p1={x:0,y:0}}function randomRange(t,i){return t+Math.random()*(i-t)}function getRandom(t){return t[Math.floor(Math.random()*t.length)]}function lerp(t,i,n,e){return(e=e||{x:0,y:0}).x=t.x+n*(i.x-t.x),e.y=t.y+n*(i.y-t.y),e}window.onload=function(){initDrawingCanvas(),createNodes(),connectNodes(),transmit(),setInterval(transmit,2e3),requestAnimationFrame(loop)},Node.prototype={update:function(){this.x=this._x+Math.sin(time)*this.r,this.y=this._y+Math.cos(time)*this.r},draw:function(){ctx.strokeStyle="rgba(50,0,250,0.75)",ctx.fillStyle="rgba(0,250,200,1)",ctx.lineWidth=.1,ctx.fillRect(this.x,this.y,1,1);for(var t=0;t<this.connections.length;t++)ctx.beginPath(),ctx.moveTo(this.x,this.y),ctx.lineTo(this.connections[t].x,this.connections[t].y),ctx.stroke()}},Signal.prototype={update:function(){var t=!1;this.completeParts.length=0;for(var i=this.parts.length-1;0<=i;i--)this.parts[i].time+=timeStep,this.parts[i].complete&&this.completeParts.push(this.parts.splice(i,1)[0]);if(0<this.completeParts.length&&(this.jumps++,this.strength--,t=3===this.jumps),!1===t)for(var n,e,s=0;s<this.completeParts.length;s++){n=this.completeParts[s].end;for(var o=0;o<n.connections.length;o++)e=n.connections[o],this.parts.push(new SignalPart(n,e,this.strength,this.style))}return t},draw:function(){for(var t=0;t<this.parts.length;t++)this.parts[t].draw()}},SignalPart.prototype={set time(t){this.prevTime=this._time,this._time=t>=this.duration?this.duration:t,this.complete=this._time===this.duration},get time(){return this._time},draw:function(){var t=ease.outCubic(this.prevTime,0,1,this.duration),i=ease.outQuad(this.time,0,1,this.duration);lerp(this.start,this.end,t,this.p0),lerp(this.start,this.end,i,this.p1),ctx.strokeStyle=this.style,ctx.lineWidth=.5*this.strength,ctx.lineCap="round",ctx.beginPath(),ctx.moveTo(this.p0.x,this.p0.y),ctx.lineTo(this.p1.x,this.p1.y),ctx.stroke()}};var ease={inCubic:function(t,i,n,e){return n*(t/=e)*t*t+i},outCubic:function(t,i,n,e){return t/=e,n*(--t*t*t+1)+i},inQuad:function(t,i,n,e){return n*(t/=e)*t+i},outQuad:function(t,i,n,e){return-n*(t/=e)*(t-2)+i},inOutCubic:function(t,i,n,e){return(t/=e/2)<1?n/2*t*t*t+i:n/2*((t-=2)*t*t+2)+i}};